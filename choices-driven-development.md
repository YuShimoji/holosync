# Choices-Driven Development: HoloSync

最終更新: 2025-10-19 17:00 (JST)

## ゴール（現行ビジョン）
- Webブラウザ上で複数YouTube動画を同期視聴し、簡単操作と高度な自動編集体験を両立する。
- URL貼り付けに加えて検索・レコメンドなど多様な読み込み導線を提供する。
- レイアウト・字幕・チャプターなどをユーザーが柔軟にカスタマイズできるUIを構築する。

## 現在の進捗
- Webアプリ土台（`index.html`, `styles/main.css`, `scripts/main.js`）を整備し、同期アルゴリズム Phase3（バッファ/広告耐性）まで実装済み。
- `chrome.storage.local` を用いた動画ID・音量の簡易永続化とレスポンシブデザインを提供。
- CI/CD（ESLint・Prettier・Doxygen・Pages）と手動テスト手順 (`docs/TESTING.md`) を確立。

## 次のマイルストーン
- フェーズα（簡単操作拡張）: YouTube Data API / OEmbed を活用した動画検索、履歴ベースのプリセット読込、ショートカット整備。
- フェーズβ（カスタマイズ性）: レイアウトプリセット、タイルサイズ調整、テーマ/ウィンドウプリセット保存。
- フェーズγ（アドバンスド自動編集）: 字幕装飾テンプレート、マルチ視点切替、AI分析による自動チャプター/要約生成。

## 要件・制約整理
- 簡単操作導線
  - 検索UIはURL貼付と同等のスピードで動画を追加できること。
  - 外部API利用時はレート制限監視とAPIキー保護（`.env` 相当の設定管理）が必須。
  - プリセット保存は localStorage → IndexedDB → 共有リンクの順で拡張し、ブラウザ間移行を可能にする。
- レイアウトカスタマイズ
  - PC/タブレット/モバイルでレスポンシブレイアウトを維持し、タイル数が増えても描画遅延を抑える。
  - プリセット切替時に再生状態・同期を保ち、UXを損なわない。
- アドバンスド自動編集
  - 字幕装飾結果をユーザーがプレビュー・修正できるUIを提供。
  - AI利用時はコスト見積もり、利用規約遵守、APIキー管理、ユーザー同意（外部送信ログ含む）を整備する。

## 採用方針（優先案）
- フェーズα: YouTube Data API を主軸に採用し、高精度検索を実現。クォータ不足時は履歴/プリセットサジェスト（ローカル/共有）でフォールバックする。
- フェーズβ: CSS Grid プリセット切替を先行導入し、利用状況を踏まえて Drag & Drop 拡張を検証する。
- フェーズγ: クラウドAI API を短期PoCで導入し、コスト/規約評価後にローカル推論や自前パイプラインを比較する。

## 実装ロードマップ詳細
- フェーズα
  - APIキー設定・保護フロー、検索結果リスト→動画追加のUX実装。
  - プリセット保存/読込UI（localStorage → エクスポート/インポート → 共有URL）。
- フェーズβ
  - レイアウトプリセット切替UIと状態保持（再生/同期を維持）。
  - ドラッグ並び替えPoC（限定タイルセットで検証）。
  - ショートカットとヘルプモーダル整備。
- フェーズγ
  - 字幕装飾テンプレート管理とプレビュー。
  - AIチャプター生成（クラウドAPI）とキャッシュ戦略、ワイプ/メタ情報パネル設計。

## テスト戦略
- 手動テスト: `docs/TESTING.md` ケース13〜17を各フェーズ完了時の必須リグレッションとして運用。
- 自動テスト: フェーズβ以降、Playwrightで検索→追加→プリセット保存→レイアウト切替→字幕/チャプター表示までをE2E化。
- モニタリング: APIエラー/レート制限/字幕生成失敗時のログ化とユーザー通知、AIコストのダッシュボード整備。

## 要件・制約整理
- 簡単操作導線
  - 検索UIはURL貼付と同等のスピードで動画追加が行えること。
  - 外部API使用時はレート制限監視とAPIキー保護（`.env` 相当の設定管理）が必須。
  - プリセット保存はlocalStorage→IndexedDB→共有リンクの順で段階的に拡張し、ブラウザ間移行を可能にする。
- レイアウトカスタマイズ
  - PC/タブレット/モバイルでレスポンシブを維持し、タイル数増加時も描画遅延を抑える。
  - プリセット切替時に再生状態や同期を崩さない。
- アドバンスド自動編集
  - 字幕装飾結果をユーザーがプレビュー・修正できるUIを提供。
  - AI利用時はコスト見積もり、利用規約遵守、APIキー管理、ユーザー同意（外部送信ログ含む）を整備する。

## 採用方針
- フェーズα: YouTube Data API を主軸（高精度検索）に採用し、クォータ不足時は履歴/プリセットサジェストでフォールバック。
- フェーズβ: CSS Grid プリセット切替を先行導入し、利用データを踏まえて Drag&Drop 拡張を検討。
- フェーズγ: クラウドAI API で短期PoCを実施し、コスト/規約評価後にローカル推論や自前パイプラインを再比較。

## 実装ロードマップ詳細
- フェーズα
  - APIキー設定・保護フロー、検索結果リスト→追加のUX実装。
  - プリセット保存/読込のUI（localStorage→エクスポート/インポート→共有URL）。
- フェーズβ
  - レイアウトプリセット切替UIと状態保持（再生/同期維持）。
  - ドラッグ並び替えPoC（限定的なタイルセットから開始）。
  - ショートカットとヘルプモーダル整備。
- フェーズγ
  - 字幕装飾テンプレート管理とプレビュー。
  - AIチャプター生成（クラウドAPI）とキャッシュ、ワイプ/メタ情報パネル設計。

## テスト戦略
- 手動テスト: `docs/TESTING.md` ケース13〜17を各フェーズの必須リグレッションとして運用。
- 自動テスト: フェーズβ以降、Playwrightで検索→追加→プリセット保存→レイアウト切替→字幕/チャプター表示をE2E化。
- モニタリング: APIエラー、レート制限、字幕生成失敗時のログ化とユーザー通知、AIコストダッシュボード整備。

## 要件・制約整理
- 簡単操作導線（検索/プリセット）
  - 検索フォームはURL貼付と同等の速度で動画を追加できること。
  - API利用時はレート制限/クォータ監視とAPIキーの安全保管（`.env` 相当の仕組み）を必須。
  - 履歴・プリセットはブラウザ依存せず移行できる保存形式（localStorage→IndexedDB→共有リンク）を段階的に提供。
- レイアウトカスタマイズ
  - PC/タブレット/モバイルで破綻しないレスポンシブを維持しつつ、タイル数が増えても60fpsに近い描画を確保。
  - プリセット切替時に再同期・再生状態を維持し、UX低下を避ける。
- アドバンスド自動編集
  - 字幕装飾・チャプター生成はユーザーが結果を確認・修正できるUIを伴うこと。
  - 外部AI利用時のコスト試算、APIキー管理、利用規約遵守（YouTube/各AIサービス）を事前にクリアする。
  - 映像/音声データを外部送信する際はユーザー同意とログ記録を実装する。

## 採用方針（案内役）
- フェーズα: YouTube Data API を主導に据えつつ、クォータ不足時のフェールバックとして履歴サジェスト（ローカル/共有プリセット）を併用。
- フェーズβ: まず CSS Grid プリセット切替を実装し、利用状況を踏まえて Drag & Drop 拡張のスプリントを設定。
- フェーズγ: クラウドAI API を短期PoCで導入し、コスト/規約を評価後にローカル推論や自前パイプラインを比較検討。

## 実装ロードマップ詳細
- フェーズα
  - APIキー注入・設定画面プロトタイプ
  - 検索結果リスト→動画追加のフロー実装
  - プリセット保存（localStorage）→エクスポート/インポート（JSON/URL）
- フェーズβ
  - プリセット切替UI（2x2/3x3/シアター）と状態保持
  - ドラッグ並び替えPoC（対象タイルのみ）
  - キーボードショートカットのハンドラとヘルプモーダル
- フェーズγ
  - 字幕装飾テンプレート管理UIとプレビューキャンバス
  - AIチャプター生成タスク（クラウドAPI）とキャッシュ戦略
  - マルチ視点切替/ワイプ表示ロジック、メタ情報パネル

## テスト戦略詳細
- 手動テスト: `docs/TESTING.md` ケース13〜17を各フェーズ完了時のリグレッション項目に昇格。
- 自動テスト: Playwrightで検索→追加→プリセット保存→レイアウト切替→字幕/チャプター表示までをE2Eに統合（フェーズβ以降）。
- モニタリング: APIエラーハンドリング、クォータ超過時のリトライ/インフォメーション表示、字幕生成失敗時のフォールバックログを収集。

## Docs & CI
- `docs/WORKFLOW.md` に従い、Issue/MR テンプレートと CI ステージ（lint → docs → deploy）を運用。
- Doxygen 出力（`docs/`）を GitLab Pages へ公開。新規機能の API 仕様は JSDoc 増補で追随予定。
- 共有ルールに記載の `scripts/creativity-booster.js` / `report-style-hint.js` は未整備。暫定運用として手動レビューで創造性メモを `AI_CONTEXT.md` に記録する。

## 主要な意思決定と代替案
- 簡単操作導線
  - A: YouTube Data API (検索+autocomplete)。要APIキー・コスト発生。
  - B: 無料OEmbed + スクレイピング回避の候補動画サジェスト。導入容易だが検索精度限定。
  - C: 共有プリセット/履歴を活用したチーム内レコメンド。API不要、既存データに依存。
- レイアウトカスタマイズ
  - A: CSS Grid プリセット切替（2x2, 3x3, シアター etc）。実装軽量。
  - B: Drag & Drop + サイズ可変（`ResizeObserver` + `pointer` API）。柔軟だが複雑。
  - C: 外部プリセットJSONを読み込み、共同編集可能に。運用コスト増。
- 自動編集/AI連携
  - A: ローカルAI（ONNX/TF.js）で簡易要約。依存少、精度課題。
  - B: クラウドAPI（OpenAI/Vertexなど）連携で字幕装飾・要約。コスト・キー管理が必要。
  - C: サーバレスワーカーで音声書き起こし→チャプター生成。インフラ構築が前提。

## リスク・制約
- YouTube API 利用規約とレート制限（検索/字幕取得）。
- 自動字幕生成/要約に外部サービスを使う場合のコストとプライバシー管理。
- 動画埋め込み・自動再生制限に伴うUX低下。同期精度はネットワークに依存。

## テスト指針（現行）
- `docs/TESTING.md` のケース1〜12（追加/再生/停止/同期/広告耐性/レスポンシブ 等）。
- 追加予定: 検索導線、プリセット保存/読込、字幕装飾プレビュー、自動チャプター検証。

## レガシー（参照用）
- 旧Chrome拡張資産は `legacy/` ディレクトリに保管。現行Webアプリには直接利用しない。
- `manifest.json`, `background.js`, `app.html`, `app.js`, `styles.css` は将来ブラウザ拡張へ再展開する際の参考資料。
