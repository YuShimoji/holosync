<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>HoloSync - Web App</title>
    <link rel="stylesheet" href="styles/main.css" />
  </head>
  <body>
    <aside class="sidebar" id="sidebar">
      <header class="brand">
        <button id="sidebarToggle" class="sidebar-toggle" title="メニューを折りたたむ">
          <span class="toggle-icon">◀</span>
        </button>
        <div class="brand-text">
          <h1>HoloSync</h1>
          <p class="subtitle">YouTube 複数動画の一括操作と同期</p>
        </div>
        <button id="darkModeToggle" class="dark-mode-toggle" title="ダークモード切り替え">
          <span class="theme-icon">🌙</span>
        </button>
      </header>

      <section class="section">
        <h2>動画を追加</h2>
        <div class="add-mode-tabs">
          <button id="singleModeBtn" class="mode-tab active" title="1つずつ追加">単体</button>
          <button id="bulkModeBtn" class="mode-tab" title="複数URLを一括追加">一括</button>
        </div>
        <div id="singleAddMode">
          <form id="addForm" class="add-form">
            <input id="urlInput" type="url" placeholder="YouTubeのURLを貼り付け" required />
            <button type="submit" class="primary">追加</button>
          </form>
          <div id="urlPreview" class="url-preview" hidden>
            <img id="urlPreviewThumb" src="" alt="" class="preview-thumb" />
            <div class="preview-info">
              <div id="urlPreviewTitle" class="preview-title"></div>
              <div id="urlPreviewAuthor" class="preview-author"></div>
            </div>
          </div>
          <p class="hint">対応例: https://www.youtube.com/watch?v=..., https://youtu.be/...</p>
        </div>
        <div id="bulkAddMode" hidden>
          <textarea
            id="bulkUrlInput"
            class="bulk-textarea"
            placeholder="複数のYouTube URLを改行で区切って貼り付け&#10;例:&#10;https://www.youtube.com/watch?v=abc123...&#10;https://youtu.be/xyz789..."
          ></textarea>
          <div class="bulk-actions">
            <button id="bulkAddBtn" class="primary">一括追加</button>
            <span id="bulkCount" class="bulk-count"></span>
          </div>
          <p class="hint">
            改行区切りで複数URLを貼り付けてください。重複は自動でスキップされます。
          </p>
        </div>
        <div id="addError" class="error" hidden></div>
      </section>

      <section class="section search-panel">
        <h2>動画検索</h2>
        <div class="api-key-section">
          <label for="apiKeyInput">YouTube API Key:</label>
          <div class="api-key-controls">
            <input id="apiKeyInput" type="password" placeholder="APIキーを入力" />
            <button id="deleteApiKeyBtn" class="delete-btn" title="APIキーを削除">🗑️</button>
          </div>
          <div id="apiKeyStatus" class="api-key-status">
            <span id="quotaInfo">クオータ: 未確認</span>
            <button id="checkQuotaBtn" class="small-btn">確認</button>
          </div>
        </div>
        <form id="searchForm" class="search-form">
          <input id="searchInput" type="text" placeholder="キーワードで検索" required />
          <button type="submit" class="primary">検索</button>
        </form>
        <ul id="searchResults" class="search-results" hidden></ul>
        <div id="searchError" class="error" hidden></div>
      </section>

      <section class="section preset-panel">
        <h2>プリセット</h2>
        <button id="savePresetBtn">現在のセットを保存</button>
        <input id="presetNameInput" type="text" placeholder="プリセット名" />
        <ul id="presetList" class="preset-list"></ul>
      </section>

      <section class="section">
        <h2>一括操作</h2>
        <div class="controls">
          <button id="playAll" class="primary">全て再生</button>
          <button id="pauseAll">全て一時停止</button>
          <button id="muteAll">全てミュート</button>
          <button id="unmuteAll">全てミュート解除</button>
          <button id="syncAll">同期</button>
          <label class="speed">
            速度
            <select id="speedAll">
              <option value="0.25">0.25x</option>
              <option value="0.5">0.5x</option>
              <option value="0.75">0.75x</option>
              <option value="1" selected>1x</option>
              <option value="1.25">1.25x</option>
              <option value="1.5">1.5x</option>
              <option value="1.75">1.75x</option>
              <option value="2">2x</option>
            </select>
          </label>
          <label class="volume">
            音量
            <input id="volumeAll" type="range" min="0" max="100" step="1" value="50" />
            <span id="volumeVal">50</span>
          </label>
        </div>
        <p class="note">Autoplay制限のため、最初の「全て再生」はミュート状態で開始されます。</p>
      </section>

      <section class="section sync-settings">
        <h2>同期設定</h2>
        <label>
          <select id="leaderMode">
            <option value="first" selected>最初の動画</option>
            <option value="longest-playing">最も長く再生している動画</option>
            <option value="least-buffered">最も安定している動画</option>
            <option value="manual">手動選択</option>
          </select>
          基準プレイヤー選択
        </label>
        <div id="manualLeaderSection" hidden>
          <label>
            <select id="leaderId">
              <!-- Options will be populated dynamically -->
            </select>
            基準動画ID
          </label>
        </div>
        <label>
          <input type="range" id="toleranceMs" min="100" max="2000" step="100" value="300" />
          <span>同期許容値: <span id="toleranceValue">300</span>ms</span>
        </label>
        <label>
          <input type="range" id="syncFrequency" min="1" max="10" step="1" value="2" />
          <span>同期頻度: <span id="syncFrequencyValue">2</span>Hz</span>
        </label>
      </section>

      <section class="section recovery-settings">
        <h2>回復設定</h2>
        <label>
          <input type="checkbox" id="retryOnError" checked />
          エラー時に自動回復を試行
        </label>
        <label>
          <select id="fallbackMode">
            <option value="mute-continue" selected>ミュート継続</option>
            <option value="pause-catchup">一時停止後追いかけ再生</option>
            <option value="none">なし</option>
          </select>
          フォールバックモード
        </label>
      </section>

      <section class="section onboarding-section">
        <h2>クイックスタート</h2>
        <div class="onboarding-buttons">
          <button id="loadDemoBtn" class="demo-btn" title="サンプル動画をセットして機能を体験">
            🎬 デモをロード
          </button>
          <button id="showHelpBtn" class="help-btn" title="ショートカットキー一覧を表示">
            ❓ ヘルプ
          </button>
        </div>
      </section>

      <footer class="footer">
        <small>HoloSync Web</small>
      </footer>
    </aside>

    <main class="content" id="content">
      <div class="content-toolbar" id="contentToolbar">
        <button id="sidebarOpen" class="sidebar-open-btn" title="メニューを開く" hidden>
          <span>☰</span>
        </button>
        <div class="layout-controls">
          <label class="layout-label">レイアウト:</label>
          <select id="layoutSelect" class="layout-select">
            <option value="auto">自動</option>
            <option value="1">1列</option>
            <option value="2">2列</option>
            <option value="3">3列</option>
            <option value="4">4列</option>
            <option value="theater">シアター</option>
            <option value="free">フリー配置</option>
          </select>
        </div>
        <div class="gap-controls">
          <label class="gap-label">間隔:</label>
          <input id="gridGap" type="range" min="0" max="24" step="2" value="8" class="gap-slider" />
          <span id="gridGapVal">8</span>px
        </div>
        <button id="shareBtn" class="share-btn" title="現在の状態を共有URLとしてコピー">
          🔗 共有
        </button>
        <div class="drop-zone-hint" id="dropHint" hidden>ここにYouTube URLをドロップ</div>
        <button
          id="debugToggle"
          class="debug-toggle toolbar-debug-toggle"
          title="デバッグパネル切り替え"
        >
          🐛 Debug
        </button>
      </div>
      <div id="debugPanel" class="debug-panel" hidden>
        <header class="debug-header">
          <h3>同期デバッグパネル</h3>
          <button id="debugClose" class="debug-close" title="パネルを閉じる">×</button>
        </header>
        <div id="debugContent" class="debug-content">
          <p>動画を追加して再生を開始すると、状態が表示されます。</p>
        </div>
      </div>
      <div id="grid" class="grid" aria-live="polite"></div>
    </main>

    <!-- Help Modal -->
    <div id="helpModal" class="modal-overlay">
      <div class="modal-content">
        <header class="modal-header">
          <h2>キーボードショートカット</h2>
          <button id="closeHelpBtn" class="modal-close">×</button>
        </header>
        <div class="modal-body">
          <table class="shortcut-table">
            <tr>
              <td><kbd>Space</kbd></td>
              <td>全て再生/一時停止</td>
            </tr>
            <tr>
              <td><kbd>M</kbd></td>
              <td>全てミュート</td>
            </tr>
            <tr>
              <td><kbd>U</kbd></td>
              <td>全てミュート解除</td>
            </tr>
            <tr>
              <td><kbd>S</kbd></td>
              <td>全て同期</td>
            </tr>
            <tr>
              <td><kbd>F</kbd></td>
              <td>最初の動画をフルスクリーン</td>
            </tr>
            <tr>
              <td><kbd>Shift+1~9</kbd></td>
              <td>N番目の動画をフルスクリーン</td>
            </tr>
            <tr>
              <td><kbd>Esc</kbd></td>
              <td>デバッグパネルを閉じる</td>
            </tr>
            <tr>
              <td><kbd>?</kbd></td>
              <td>このヘルプを表示</td>
            </tr>
          </table>
          <p class="modal-hint">タイルをクリックするとその動画のみ音声再生（再クリックで解除）</p>
        </div>
      </div>
    </div>

    <script src="scripts/storage.js"></script>
    <script src="scripts/main.js"></script>
  </body>
</html>
